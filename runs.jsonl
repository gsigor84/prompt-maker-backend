{"run_id": "a5952781", "step": "collect_requirements", "requirements": null, "analysis": null, "directions": null, "draft": null, "refinement": null, "final": null}
{"run_id": "a5952781", "step": "collect_requirements", "requirements": {"task": "explain how to optimize a slow SQL query"}, "analysis": null, "directions": null, "draft": null, "refinement": null, "final": null}
{"run_id": "a5952781", "step": "analyze_requirements", "requirements": {"task": "explain how to optimize a slow SQL query"}, "analysis": {"missing_info": ["Database engine and exact version (e.g., PostgreSQL 15, MySQL 8.0, SQL Server 2019, Oracle 19c, SQLite).", "Full SQL query text to optimize.", "Schemas of all referenced tables: column names, data types, primary keys, foreign keys, constraints.", "Existing indexes on referenced tables (key columns, included/covering columns, uniqueness).", "Row counts/table sizes and data distribution/selectivity of filter/join columns (including skew).", "Current execution plan for the query (preferably actual, not estimated), in engine-specific format (e.g., PostgreSQL EXPLAIN ANALYZE, MySQL EXPLAIN FORMAT=JSON, SQL Server Actual Execution Plan).", "Observed performance metrics: average and p95/p99 latency, rows returned, CPU/IO/memory usage, and whether performance varies by time or parameters.", "Workload context: run frequency, concurrency level, OLTP vs analytics/reporting, whether inside a larger transaction, and the transaction isolation level.", "Performance goal/target (e.g., desired max latency or throughput).", "Change constraints: what is allowed (query rewrite, new/modified indexes, schema changes, configuration tuning), any downtime/maintenance windows, and storage limits.", "Environment details: hosting (on‑prem/cloud/provider), instance size (CPU/RAM), storage type (SSD/HDD, IOPS), network considerations, presence of read replicas/partitions/shards.", "Database settings relevant to the query (e.g., PostgreSQL work_mem/effective_cache_size/autovacuum and stats; MySQL innodb_buffer_pool_size; SQL Server MAXDOP/cost threshold) and whether statistics are current.", "Pagination/sorting requirements (ORDER BY, LIMIT/OFFSET) and correctness constraints that may limit rewrites.", "Whether the query is generated by an ORM/framework, and ability to add hints, rewrite SQL, or use prepared statements; any known parameter sniffing issues.", "History/baseline: when it became slow, recent data growth, schema/index/config changes, or plan regressions.", "Availability of anonymized sample data and permission to share query/plan snippets or slow-query log entries.", "Use of partitioning/materialized views/caching layers relevant to the query.", "Any errors/warnings or plan symptoms (e.g., hash/sort spills, temp files, \"Using temporary; Using filesort\", timeouts).", "Preferred output format and depth (step-by-step checklist, prioritized recommendations, code samples), and length constraints.", "Target audience skill level (beginner/intermediate/advanced) and desired tone/language."], "assumptions": ["If the database engine/version is not provided, guidance will be engine-agnostic with optional engine-specific notes.", "The user can obtain and share an execution plan and basic metadata (row counts, indexes), potentially anonymized.", "Minor query and index changes are permitted unless explicitly restricted; schema/config changes require confirmation.", "English is acceptable for the response unless another language is specified."]}, "directions": null, "draft": null, "refinement": null, "final": null}
{"run_id": "a5952781", "step": "propose_directions", "requirements": {"task": "explain how to optimize a slow SQL query"}, "analysis": {"missing_info": ["Database engine and exact version (e.g., PostgreSQL 15, MySQL 8.0, SQL Server 2019, Oracle 19c, SQLite).", "Full SQL query text to optimize.", "Schemas of all referenced tables: column names, data types, primary keys, foreign keys, constraints.", "Existing indexes on referenced tables (key columns, included/covering columns, uniqueness).", "Row counts/table sizes and data distribution/selectivity of filter/join columns (including skew).", "Current execution plan for the query (preferably actual, not estimated), in engine-specific format (e.g., PostgreSQL EXPLAIN ANALYZE, MySQL EXPLAIN FORMAT=JSON, SQL Server Actual Execution Plan).", "Observed performance metrics: average and p95/p99 latency, rows returned, CPU/IO/memory usage, and whether performance varies by time or parameters.", "Workload context: run frequency, concurrency level, OLTP vs analytics/reporting, whether inside a larger transaction, and the transaction isolation level.", "Performance goal/target (e.g., desired max latency or throughput).", "Change constraints: what is allowed (query rewrite, new/modified indexes, schema changes, configuration tuning), any downtime/maintenance windows, and storage limits.", "Environment details: hosting (on‑prem/cloud/provider), instance size (CPU/RAM), storage type (SSD/HDD, IOPS), network considerations, presence of read replicas/partitions/shards.", "Database settings relevant to the query (e.g., PostgreSQL work_mem/effective_cache_size/autovacuum and stats; MySQL innodb_buffer_pool_size; SQL Server MAXDOP/cost threshold) and whether statistics are current.", "Pagination/sorting requirements (ORDER BY, LIMIT/OFFSET) and correctness constraints that may limit rewrites.", "Whether the query is generated by an ORM/framework, and ability to add hints, rewrite SQL, or use prepared statements; any known parameter sniffing issues.", "History/baseline: when it became slow, recent data growth, schema/index/config changes, or plan regressions.", "Availability of anonymized sample data and permission to share query/plan snippets or slow-query log entries.", "Use of partitioning/materialized views/caching layers relevant to the query.", "Any errors/warnings or plan symptoms (e.g., hash/sort spills, temp files, \"Using temporary; Using filesort\", timeouts).", "Preferred output format and depth (step-by-step checklist, prioritized recommendations, code samples), and length constraints.", "Target audience skill level (beginner/intermediate/advanced) and desired tone/language."], "assumptions": ["If the database engine/version is not provided, guidance will be engine-agnostic with optional engine-specific notes.", "The user can obtain and share an execution plan and basic metadata (row counts, indexes), potentially anonymized.", "Minor query and index changes are permitted unless explicitly restricted; schema/config changes require confirmation.", "English is acceptable for the response unless another language is specified."]}, "directions": {"options": [{"name": "Structured JSON Intake Template", "rationale": "Provide a single, copy-pasteable JSON skeleton that mirrors the listed missing_info fields as keys (accepting null/unknown), plus sections for assumptions and allowed changes. This ensures complete, machine-readable context, reduces back-and-forth, and lets the model deliver engine-agnostic guidance with optional engine-specific notes when fields are present."}, {"name": "Two-Stage Tuning: Quick Wins then Targeted Deep Dive", "rationale": "Craft a prompt that first requests/uses a minimal subset (e.g., engine/version, query text, and current plan if available) to produce immediate, low-risk recommendations; then instructs the model to enumerate the top-priority next artifacts (chosen from the provided list) that would most improve precision, explaining how each would refine advice. This yields progress with partial info and a clear path to deeper optimization."}, {"name": "Goal- and Constraint-Driven Prioritized Recommendations", "rationale": "Center the prompt on performance objectives and change constraints from the provided categories, plus workload context, so outputs are ranked by impact, safety, and feasibility (query rewrite vs index vs config). Instruct the model to tailor advice to OLTP/analytics patterns, call out parameter-sensitivity risks, and format results per the requested output style/length and audience level."}]}, "draft": null, "refinement": null, "final": null}
{"run_id": "a5952781", "task": "explain how to optimize a slow SQL query", "chosen_direction_name": "Structured JSON Intake Template", "step": "CHOSEN_DIRECTION"}
